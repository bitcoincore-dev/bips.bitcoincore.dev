<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="share and save bitcoin BIPs">
    <meta name="keywords" content="bitcoin, bitcoin improvement proposals, bip, bips, static, share">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="/style.css" />

    <title>bips.dev - BIP 381</title>
</head>

<body>
    <section class="section">
        <div class="container">
            
    <div class="level">
        <div class="level-left">
            <div class="level-item">
                <a href="/"><img src="/bips-dev-header.png" width="375", height="100" /></a>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <a href="/">Back to BIPs</a>
            </div>
        </div>
    </div>

    <p class="is-size-3 has-text-weight-bold mb-0">
      BIP 381: Non-Segwit Output Script Descriptors
    </p>
    <div class="level is-mobile">
        <div class="level-left">
            <div class="level-item">
                <p class="subtitle"><strong>2021-06-27</strong></p>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <a href="https:&#x2F;&#x2F;github.com&#x2F;bitcoin&#x2F;bips&#x2F;blob&#x2F;master&#x2F;bip-0381.mediawiki">View on GitHub</a>
            </div>
        </div>
    </div>

    <div class="content">
      <pre style="background-color:#fafafa;color:#61676c;"><code><span>  BIP: 381
</span><span>  Layer: Applications
</span><span>  Title: Non-Segwit Output Script Descriptors
</span><span>  Author: Pieter Wuille &lt;pieter@wuille.net&gt;
</span><span>          Andrew Chow &lt;andrew@achow101.com&gt;
</span><span>  Comments-Summary: No comments yet.
</span><span>  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0381
</span><span>  Status: Draft
</span><span>  Type: Informational
</span><span>  Created: 2021-06-27
</span><span>  License: BSD-2-Clause
</span></code></pre>
<h2 id="Abstract">Abstract</h2>
<p>This document specifies <code>pk()</code>, <code>pkh()</code>, and <code>sh()</code> output script
descriptors. <code>pk()</code> descriptors take a key and produces a P2PK output
script. <code>pkh()</code> descriptors take a key and produces a P2PKH output
script. <code>sh()</code> descriptors take a script and produces a P2SH output
script.</p>
<h2 id="Copyright">Copyright</h2>
<p>This BIP is licensed under the BSD 2-clause license.</p>
<h2 id="Motivation">Motivation</h2>
<p>Prior to the activation of Segregated Witness, there were 3 main
standard output script formats: P2PK, P2PKH, and P2SH. These expressions
allow specifying those formats as a descriptor.</p>
<h2 id="Specification">Specification</h2>
<p>Three new script expressions are defined: <code>pk()</code>, <code>pkh()</code>, and <code>sh()</code>.</p>
<h3 id="pk()"><code>pk()</code></h3>
<p>The <code>pk(KEY)</code> expression can be used in any context or level of a
descriptor. It takes a single key expression as an argument and produces
a P2PK output script. Depending on the higher level descriptors, there
may be restrictions on the type of public keys that can be included.
Such restrictions will be specified by those descriptors.</p>
<p>The output script produced is:</p>
<pre style="background-color:#fafafa;color:#61676c;"><code><span>&lt;KEY&gt; OP_CHECKSIG
</span></code></pre>
<h3 id="pkh()"><code>pkh()</code></h3>
<p>The <code>pkh(KEY)</code> expression can be used as a top level expression, or
inside of either a <code>sh()</code> or <code>wsh()</code> descriptor. It takes a single key
expression as an argument and produces a P2PKH output script. Depending
on the higher level descriptors, there may be restrictions on the type
of public keys that can be included. Such restrictions will be specified
by those descriptors.</p>
<p>The output script produced is:</p>
<pre style="background-color:#fafafa;color:#61676c;"><code><span>OP_DUP OP_HASH160 &lt;KEY_hash160&gt; OP_EQUALVERIFY OP_CHECKSIG
</span></code></pre>
<h3 id="sh()"><code>sh()</code></h3>
<p>The <code>sh(SCRIPT)</code> expression can only be used as a top level expression.
It takes a single script expression as an argument and produces a P2SH
output script. <code>sh()</code> expressions also create a redeemScript which is
required in order to spend outputs which use its output script. This
redeemScript is the output script produced by the <code>SCRIPT</code> argument to
<code>sh()</code>.</p>
<p>The output script produced is:</p>
<pre style="background-color:#fafafa;color:#61676c;"><code><span>OP_HASH160 &lt;SCRIPT_hash160&gt; OP_EQUAL
</span></code></pre>
<h2 id="Test_Vectors">Test Vectors</h2>
<p>Valid descriptors followed by the scripts they produce. Descriptors
involving derived child keys will have the 0th, 1st, and 2nd scripts
listed.</p>
<ul>
<li><code>pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)</code>
<ul>
<li><code>2103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bdac</code></li>
</ul>
</li>
<li><code>pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)</code>
<ul>
<li><code>2103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bdac</code></li>
</ul>
</li>
<li><code>pkh([deadbeef/1/2'/3/4']L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1)</code>
<ul>
<li><code>76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac</code></li>
</ul>
</li>
<li><code>pkh([deadbeef/1/2'/3/4']03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)</code>
<ul>
<li><code>76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac</code></li>
</ul>
</li>
<li><code>pkh([deadbeef/1/2h/3/4h]03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)</code>
<ul>
<li><code>76a9149a1c78a507689f6f54b847ad1cef1e614ee23f1e88ac</code></li>
</ul>
</li>
<li><code>pk(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)</code>
<ul>
<li><code>4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235ac</code></li>
</ul>
</li>
<li><code>pk(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)</code>
<ul>
<li><code>4104a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235ac</code></li>
</ul>
</li>
<li><code>pkh(5KYZdUEo39z3FPrtuX2QbbwGnNP5zTd7yyr2SC1j299sBCnWjss)</code>
<ul>
<li><code>76a914b5bd079c4d57cc7fc28ecf8213a6b791625b818388ac</code></li>
</ul>
</li>
<li><code>pkh(04a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd5b8dec5235a0fa8722476c7709c02559e3aa73aa03918ba2d492eea75abea235)</code>
<ul>
<li><code>76a914b5bd079c4d57cc7fc28ecf8213a6b791625b818388ac</code></li>
</ul>
</li>
<li><code>sh(pk(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))</code>
<ul>
<li><code>a9141857af51a5e516552b3086430fd8ce55f7c1a52487</code></li>
</ul>
</li>
<li><code>sh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))</code>
<ul>
<li><code>a9141857af51a5e516552b3086430fd8ce55f7c1a52487</code></li>
</ul>
</li>
<li><code>sh(pkh(L4rK1yDtCWekvXuE6oXD9jCYfFNV2cWRpVuPLBcCU2z8TrisoyY1))</code>
<ul>
<li><code>a9141a31ad23bf49c247dd531a623c2ef57da3c400c587</code></li>
</ul>
</li>
<li><code>sh(pkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))</code>
<ul>
<li><code>a9141a31ad23bf49c247dd531a623c2ef57da3c400c587</code></li>
</ul>
</li>
<li><code>pkh(xprv9s21ZrQH143K31xYSDQpPDxsXRTUcvj2iNHm5NUtrGiGG5e2DtALGdso3pGz6ssrdK4PFmM8NSpSBHNqPqm55Qn3LqFtT2emdEXVYsCzC2U/2147483647'/0)</code>
<ul>
<li><code>76a914ebdc90806a9c4356c1c88e42216611e1cb4c1c1788ac</code></li>
</ul>
</li>
<li><code>pkh(xpub661MyMwAqRbcFW31YEwpkMuc5THy2PSt5bDMsktWQcFF8syAmRUapSCGu8ED9W6oDMSgv6Zz8idoc4a6mr8BDzTJY47LJhkJ8UB7WEGuduB/2147483647'/0)</code>
<ul>
<li><code>76a914ebdc90806a9c4356c1c88e42216611e1cb4c1c1788ac</code></li>
</ul>
</li>
<li><code>pkh([bd16bee5/2147483647h]xpub69H7F5dQzmVd3vPuLKtcXJziMEQByuDidnX3YdwgtNsecY5HRGtAAQC5mXTt4dsv9RzyjgDjAQs9VGVV6ydYCHnprc9vvaA5YtqWyL6hyds/0)</code>
<ul>
<li><code>76a914ebdc90806a9c4356c1c88e42216611e1cb4c1c1788ac</code></li>
</ul>
</li>
<li><code>pk(xprv9uPDJpEQgRQfDcW7BkF7eTya6RPxXeJCqCJGHuCJ4GiRVLzkTXBAJMu2qaMWPrS7AANYqdq6vcBcBUdJCVVFceUvJFjaPdGZ2y9WACViL4L/0)</code>
<ul>
<li><code>210379e45b3cf75f9c5f9befd8e9506fb962f6a9d185ac87001ec44a8d3df8d4a9e3ac</code></li>
</ul>
</li>
<li><code>pk(xpub68NZiKmJWnxxS6aaHmn81bvJeTESw724CRDs6HbuccFQN9Ku14VQrADWgqbhhTHBaohPX4CjNLf9fq9MYo6oDaPPLPxSb7gwQN3ih19Zm4Y/0)</code>
<ul>
<li><code>210379e45b3cf75f9c5f9befd8e9506fb962f6a9d185ac87001ec44a8d3df8d4a9e3ac</code></li>
</ul>
</li>
</ul>
<p>Invalid descriptors</p>
<ul>
<li><code>pk()</code> only accepts key expressions:
<code>pk(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))</code></li>
<li><code>pkh()</code> only accepts key expressions:
<code>pkh(pk(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd))</code></li>
<li><code>sh()</code> only acceps script expressions:
<code>sh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)</code></li>
<li><code>sh()</code> is top level only:
<code>sh(sh(pkh(03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd)))</code></li>
</ul>
<h2 id="Backwards_Compatibility">Backwards Compatibility</h2>
<p><code>pk()</code>, <code>pkh()</code>, and <code>sh()</code> descriptors use the format and general
operation specified in <a href="/380">380</a>. As these
are a wholly new descriptors, they are not compatible with any
implementation. However the scripts produced are standard scripts so
existing software are likely to be familiar with them.</p>
<h2 id="Reference_Implementation">Reference Implementation</h2>
<p><code>pk()</code>, <code>pkh()</code>, and <code>sh()</code> descriptors have been implemented in Bitcoin
Core since version 0.17.</p>

    </div>

        </div>
    </section>
    <footer class="footer">
        <div class="container has-text-centered has-text-weight-bold is-family-monospace">
            <p class="mb-1">Updated <span class="tag is-medium is-warning is-light">2023-10-04</span></p>
            <p>bips.dev - Made with &#x2615; by <a href="https://twitter.com/nickmonad">nickmonad</a></p>
            <p>Check it out on <a href="https://github.com/nickmonad/bips-dev">GitHub</a></p>
            <p>Stay humble. Stack sats. &#x20bf;</p>
        </div>
    </footer>

     
</body>
</html>
