<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="share and save bitcoin BIPs">
    <meta name="keywords" content="bitcoin, bitcoin improvement proposals, bip, bips, static, share">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="/style.css" />

    <title>bips.dev - BIP 143</title>
</head>

<body>
    <section class="section">
        <div class="container">
            
    <div class="level">
        <div class="level-left">
            <div class="level-item">
                <a href="/"><img src="/bips-dev-header.png" width="375", height="100" /></a>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <a href="/">Back to BIPs</a>
            </div>
        </div>
    </div>

    <p class="is-size-3 has-text-weight-bold mb-0">
      BIP 143: Transaction Signature Verification for Version 0 Witness Program
    </p>
    <div class="level is-mobile">
        <div class="level-left">
            <div class="level-item">
                <p class="subtitle"><strong>2016-01-03</strong></p>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <a href="https:&#x2F;&#x2F;github.com&#x2F;bitcoin&#x2F;bips&#x2F;blob&#x2F;master&#x2F;bip-0143.mediawiki">View on GitHub</a>
            </div>
        </div>
    </div>

    <div class="content">
      <pre style="background-color:#fafafa;color:#61676c;"><code><span>  BIP: 143
</span><span>  Layer: Consensus (soft fork)
</span><span>  Title: Transaction Signature Verification for Version 0 Witness Program
</span><span>  Author: Johnson Lau &lt;jl2012@xbt.hk&gt;
</span><span>          Pieter Wuille &lt;pieter.wuille@gmail.com&gt;
</span><span>  Comments-Summary: No comments yet.
</span><span>  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0143
</span><span>  Status: Final
</span><span>  Type: Standards Track
</span><span>  Created: 2016-01-03
</span><span>  License: PD
</span></code></pre>
<h2 id="Abstract">Abstract</h2>
<p>This proposal defines a new transaction digest algorithm for signature
verification in version 0 witness program, in order to minimize
redundant data hashing in verification, and to cover the input value by
the signature.</p>
<h2 id="Motivation">Motivation</h2>
<p>There are 4 ECDSA signature verification codes in the original Bitcoin
script system: <code>CHECKSIG</code>, <code>CHECKSIGVERIFY</code>, <code>CHECKMULTISIG</code>,
<code>CHECKMULTISIGVERIFY</code> (“sigops”). According to the sighash type (<code>ALL</code>,
<code>NONE</code>, <code>SINGLE</code>, <code>ANYONECANPAY</code>), a transaction digest is generated
with a double SHA256 of a serialized subset of the transaction, and the
signature is verified against this digest with a given public key. The
detailed procedure is described in a Bitcoin Wiki article. <sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>Unfortunately, there are at least 2 weaknesses in the original
SignatureHash transaction digest algorithm:</p>
<ul>
<li>For the verification of each signature, the amount of data hashing is
proportional to the size of the transaction. Therefore, data hashing
grows in O(n<sup>2</sup>) as the number of sigops in a transaction
increases. While a 1 MB block would normally take 2 seconds to verify
with an average computer in 2015, a 1MB transaction with 5569 sigops
may take 25 seconds to verify. This could be fixed by optimizing the
digest algorithm by introducing some reusable “midstate”, so the time
complexity becomes O(n). <sup class="footnote-reference"><a href="#2">2</a></sup><sup class="footnote-reference"><a href="#3">3</a></sup><sup class="footnote-reference"><a href="#4">4</a></sup></li>
<li>The algorithm does not involve the amount of Bitcoin being spent by
the input. This is usually not a problem for online network nodes as
they could request for the specified transaction to acquire the output
value. For an offline transaction signing device (&quot;cold wallet&quot;),
however, the unknowing of input amount makes it impossible to
calculate the exact amount being spent and the transaction fee. To
cope with this problem a cold wallet must also acquire the full
transaction being spent, which could be a big obstacle in the
implementation of lightweight, air-gapped wallet. By including the
input value of part of the transaction digest, a cold wallet may
safely sign a transaction by learning the value from an untrusted
source. In the case that a wrong value is provided and signed, the
signature would be invalid and no funding might be lost. <sup class="footnote-reference"><a href="#5">5</a></sup></li>
</ul>
<p>Deploying the aforementioned fixes in the original script system is not
a simple task. That would be either a hardfork, or a softfork for new
sigops without the ability to remove or insert stack items. However, the
introduction of segregated witness softfork offers an opportunity to
define a different set of script semantics without disrupting the
original system, as the unupgraded nodes would always consider such a
transaction output is spendable by arbitrary signature or no signature
at all. <sup class="footnote-reference"><a href="#6">6</a></sup></p>
<h2 id="Specification">Specification</h2>
<p>A new transaction digest algorithm is defined, but only applicable to
sigops in version 0 witness program:</p>
<p><code> Double SHA256 of the serialization of:</code><br />
<code>    1. nVersion of the transaction (4-byte little endian)</code><br />
<code>    2. hashPrevouts (32-byte hash)</code><br />
<code>    3. hashSequence (32-byte hash)</code><br />
<code>    4. outpoint (32-byte hash + 4-byte little endian) </code><br />
<code>    5. scriptCode of the input (serialized as scripts inside CTxOuts)</code><br />
<code>    6. value of the output spent by this input (8-byte little endian)</code><br />
<code>    7. nSequence of the input (4-byte little endian)</code><br />
<code>    8. hashOutputs (32-byte hash)</code><br />
<code>    9. nLocktime of the transaction (4-byte little endian)</code><br />
<code>   10. sighash type of the signature (4-byte little endian)</code></p>
<p>Semantics of the original sighash types remain unchanged, except the
followings:</p>
<ol>
<li>The way of serialization is changed;</li>
<li>All sighash types commit to the amount being spent by the signed
input;</li>
<li><code>FindAndDelete</code> of the signature is not applied to the <code>scriptCode</code>;</li>
<li><code>OP_CODESEPARATOR</code>(s) after the last executed <code>OP_CODESEPARATOR</code> are
not removed from the <code>scriptCode</code> (the last executed
<code>OP_CODESEPARATOR</code> and any script before it are always removed);</li>
<li><code>SINGLE</code> does not commit to the input index. When <code>ANYONECANPAY</code> is
not set, the semantics are unchanged since <code>hashPrevouts</code> and
<code>outpoint</code> together implictly commit to the input index. When
<code>SINGLE</code> is used with <code>ANYONECANPAY</code>, omission of the index
commitment allows permutation of the input-output pairs, as long as
each pair is located at an equivalent index.</li>
</ol>
<p>The items 1, 4, 7, 9, 10 have the same meaning as the original
algorithm. <sup class="footnote-reference"><a href="#7">7</a></sup></p>
<p>The item 5:</p>
<ul>
<li>For <code>P2WPKH</code> witness program, the <code>scriptCode</code> is
<code>0x1976a914{20-byte-pubkey-hash}88ac</code>.</li>
<li>For <code>P2WSH</code> witness program,
<ul>
<li>if the <code>witnessScript</code> does not contain any <code>OP_CODESEPARATOR</code>, the
<code>scriptCode</code> is the <code>witnessScript</code> serialized as scripts inside
<code>CTxOut</code>.</li>
<li>if the <code>witnessScript</code> contains any <code>OP_CODESEPARATOR</code>, the
<code>scriptCode</code> is the <code>witnessScript</code> but removing everything up to
and including the last executed <code>OP_CODESEPARATOR</code> before the
signature checking opcode being executed, serialized as scripts
inside <code>CTxOut</code>. (The exact semantics is demonstrated in the
examples below)</li>
</ul>
</li>
</ul>
<p>The item 6 is a 8-byte value of the amount of bitcoin spent in this
input.</p>
<p><code>hashPrevouts</code>:</p>
<ul>
<li>If the <code>ANYONECANPAY</code> flag is not set, <code>hashPrevouts</code> is the double
SHA256 of the serialization of all input outpoints;</li>
<li>Otherwise, <code>hashPrevouts</code> is a <code>uint256</code> of <code>0x0000......0000</code>.</li>
</ul>
<p><code>hashSequence</code>:</p>
<ul>
<li>If none of the <code>ANYONECANPAY</code>, <code>SINGLE</code>, <code>NONE</code> sighash type is set,
<code>hashSequence</code> is the double SHA256 of the serialization of
<code>nSequence</code> of all inputs;</li>
<li>Otherwise, <code>hashSequence</code> is a <code>uint256</code> of <code>0x0000......0000</code>.</li>
</ul>
<p><code>hashOutputs</code>:</p>
<ul>
<li>If the sighash type is neither <code>SINGLE</code> nor <code>NONE</code>, <code>hashOutputs</code> is
the double SHA256 of the serialization of all output amount (8-byte
little endian) with <code>scriptPubKey</code> (serialized as scripts inside
CTxOuts);</li>
<li>If sighash type is <code>SINGLE</code> and the input index is smaller than the
number of outputs, <code>hashOutputs</code> is the double SHA256 of the output
amount with <code>scriptPubKey</code> of the same index as the input;</li>
<li>Otherwise, <code>hashOutputs</code> is a <code>uint256</code> of <code>0x0000......0000</code>.<sup class="footnote-reference"><a href="#8">8</a></sup></li>
</ul>
<p>The <code>hashPrevouts</code>, <code>hashSequence</code>, and <code>hashOutputs</code> calculated in an
earlier verification may be reused in other inputs of the same
transaction, so that the time complexity of the whole hashing process
reduces from O(n<sup>2</sup>) to O(n).</p>
<p>Refer to the reference implementation, reproduced below, for the precise
algorithm:</p>
<pre data-lang="cpp" style="background-color:#fafafa;color:#61676c;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span>  uint256 hashPrevouts</span><span style="color:#61676ccc;">;
</span><span>  uint256 hashSequence</span><span style="color:#61676ccc;">;
</span><span>  uint256 hashOutputs</span><span style="color:#61676ccc;">;
</span><span>  
</span><span>  </span><span style="color:#fa6e32;">if </span><span>(</span><span style="color:#ed9366;">!</span><span>(nHashType </span><span style="color:#ed9366;">&amp;</span><span> SIGHASH_ANYONECANPAY)) {
</span><span>      CHashWriter </span><span style="color:#f29718;">ss</span><span>(SER_GETHASH</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">0</span><span>)</span><span style="color:#61676ccc;">;
</span><span>      </span><span style="color:#fa6e32;">for </span><span>(</span><span style="color:#fa6e32;">unsigned int</span><span> n </span><span style="color:#ed9366;">= </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;</span><span> n </span><span style="color:#ed9366;">&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vin</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">size</span><span>()</span><span style="color:#61676ccc;">;</span><span> n</span><span style="color:#ed9366;">++</span><span>) {
</span><span>          ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vin[n]</span><span style="color:#ed9366;">.</span><span>prevout</span><span style="color:#61676ccc;">;
</span><span>      }
</span><span>      hashPrevouts </span><span style="color:#ed9366;">=</span><span> ss</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">GetHash</span><span>()</span><span style="color:#61676ccc;">;
</span><span>  }
</span><span>  
</span><span>  </span><span style="color:#fa6e32;">if </span><span>(</span><span style="color:#ed9366;">!</span><span>(nHashType </span><span style="color:#ed9366;">&amp;</span><span> SIGHASH_ANYONECANPAY) </span><span style="color:#ed9366;">&amp;&amp; </span><span>(nHashType </span><span style="color:#ed9366;">&amp; </span><span style="color:#ff8f40;">0x1f</span><span>) </span><span style="color:#ed9366;">!=</span><span> SIGHASH_SINGLE </span><span style="color:#ed9366;">&amp;&amp; </span><span>(nHashType </span><span style="color:#ed9366;">&amp; </span><span style="color:#ff8f40;">0x1f</span><span>) </span><span style="color:#ed9366;">!=</span><span> SIGHASH_NONE) {
</span><span>      CHashWriter </span><span style="color:#f29718;">ss</span><span>(SER_GETHASH</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">0</span><span>)</span><span style="color:#61676ccc;">;
</span><span>      </span><span style="color:#fa6e32;">for </span><span>(</span><span style="color:#fa6e32;">unsigned int</span><span> n </span><span style="color:#ed9366;">= </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;</span><span> n </span><span style="color:#ed9366;">&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vin</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">size</span><span>()</span><span style="color:#61676ccc;">;</span><span> n</span><span style="color:#ed9366;">++</span><span>) {
</span><span>          ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vin[n]</span><span style="color:#ed9366;">.</span><span>nSequence</span><span style="color:#61676ccc;">;
</span><span>      }
</span><span>      hashSequence </span><span style="color:#ed9366;">=</span><span> ss</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">GetHash</span><span>()</span><span style="color:#61676ccc;">;
</span><span>  }
</span><span>  
</span><span>  </span><span style="color:#fa6e32;">if </span><span>((nHashType </span><span style="color:#ed9366;">&amp; </span><span style="color:#ff8f40;">0x1f</span><span>) </span><span style="color:#ed9366;">!=</span><span> SIGHASH_SINGLE </span><span style="color:#ed9366;">&amp;&amp; </span><span>(nHashType </span><span style="color:#ed9366;">&amp; </span><span style="color:#ff8f40;">0x1f</span><span>) </span><span style="color:#ed9366;">!=</span><span> SIGHASH_NONE) {
</span><span>      CHashWriter </span><span style="color:#f29718;">ss</span><span>(SER_GETHASH</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">0</span><span>)</span><span style="color:#61676ccc;">;
</span><span>      </span><span style="color:#fa6e32;">for </span><span>(</span><span style="color:#fa6e32;">unsigned int</span><span> n </span><span style="color:#ed9366;">= </span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">;</span><span> n </span><span style="color:#ed9366;">&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vout</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">size</span><span>()</span><span style="color:#61676ccc;">;</span><span> n</span><span style="color:#ed9366;">++</span><span>) {
</span><span>          ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vout[n]</span><span style="color:#61676ccc;">;
</span><span>      }
</span><span>      hashOutputs </span><span style="color:#ed9366;">=</span><span> ss</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">GetHash</span><span>()</span><span style="color:#61676ccc;">;
</span><span>  } </span><span style="color:#fa6e32;">else if </span><span>((nHashType </span><span style="color:#ed9366;">&amp; </span><span style="color:#ff8f40;">0x1f</span><span>) </span><span style="color:#ed9366;">==</span><span> SIGHASH_SINGLE </span><span style="color:#ed9366;">&amp;&amp;</span><span> nIn </span><span style="color:#ed9366;">&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vout</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">size</span><span>()) {
</span><span>      CHashWriter </span><span style="color:#f29718;">ss</span><span>(SER_GETHASH</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">0</span><span>)</span><span style="color:#61676ccc;">;
</span><span>      ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vout[nIn]</span><span style="color:#61676ccc;">;
</span><span>      hashOutputs </span><span style="color:#ed9366;">=</span><span> ss</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">GetHash</span><span>()</span><span style="color:#61676ccc;">;
</span><span>  }
</span><span>  
</span><span>  CHashWriter </span><span style="color:#f29718;">ss</span><span>(</span><span style="color:#ff8f40;">SER_GETHASH</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">0</span><span>)</span><span style="color:#61676ccc;">;
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// Version
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>nVersion</span><span style="color:#61676ccc;">;
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// Input prevouts/nSequence (none/all, depending on flags)
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> hashPrevouts</span><span style="color:#61676ccc;">;
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> hashSequence</span><span style="color:#61676ccc;">;
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// The input being signed (replacing the scriptSig with scriptCode + amount)
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// The prevout may already be contained in hashPrevout, and the nSequence
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// may already be contain in hashSequence.
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vin[nIn]</span><span style="color:#ed9366;">.</span><span>prevout</span><span style="color:#61676ccc;">;
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt; </span><span style="color:#fa6e32;">static_cast</span><span>&lt;</span><span style="color:#fa6e32;">const</span><span> CScriptBase</span><span style="color:#ed9366;">&amp;</span><span>&gt;(scriptCode)</span><span style="color:#61676ccc;">;
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> amount</span><span style="color:#61676ccc;">;
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>vin[nIn]</span><span style="color:#ed9366;">.</span><span>nSequence</span><span style="color:#61676ccc;">;
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// Outputs (none/one/all, depending on flags)
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> hashOutputs</span><span style="color:#61676ccc;">;
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// Locktime
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> txTo</span><span style="color:#ed9366;">.</span><span>nLockTime</span><span style="color:#61676ccc;">;
</span><span>  </span><span style="font-style:italic;color:#abb0b6;">// Sighash type
</span><span>  ss </span><span style="color:#ed9366;">&lt;&lt;</span><span> nHashType</span><span style="color:#61676ccc;">;
</span><span>  
</span><span>  </span><span style="color:#fa6e32;">return</span><span> ss</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">GetHash</span><span>()</span><span style="color:#61676ccc;">;
</span></code></pre>
<h2 id="Restrictions_on_public_key_type">Restrictions on public key type</h2>
<p>As a default policy, only compressed public keys are accepted in
<code>P2WPKH</code> and <code>P2WSH</code>. Each public key passed to a sigop inside version 0
witness program must be a compressed key: the first byte MUST be either
<code>0x02</code> or <code>0x03</code>, and the size MUST be 33 bytes. Transactions that break
this rule will not be relayed or mined by default.</p>
<p>Since this policy is preparation for a future softfork proposal, to
avoid potential future funds loss, users MUST NOT use uncompressed keys
in version 0 witness programs.</p>
<h2 id="Example">Example</h2>
<p>To ensure consistency in consensus-critical behaviour, developers should
test their implementations against all the tests below. More tests
related to this proposal could be found under
<a rel="noopener" target="_blank" href="https://github.com/bitcoin/bitcoin/tree/master/src/test/data">https://github.com/bitcoin/bitcoin/tree/master/src/test/data</a> .</p>
<h3 id="Native_P2WPKH">Native P2WPKH</h3>
<p><code> The following is an unsigned transaction:</code><br />
<code>   0100000002fff7f7881a8099afa6940d42d1e7f6362bec38171ea3edf433541db4e4ad969f0000000000eeffffffef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a0100000000ffffffff02202cb206000000001976a9148280b37df378db99f66f85c95a783a76ac7a6d5988ac9093510d000000001976a9143bde42dbee7e4dbe6a21b2d50ce2f0167faa815988ac11000000</code><br />
<code>   </code><br />
<code>   nVersion:  01000000</code><br />
<code>   txin:      02 fff7f7881a8099afa6940d42d1e7f6362bec38171ea3edf433541db4e4ad969f 00000000 00 eeffffff</code><br />
<code>                 ef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a 01000000 00 ffffffff</code><br />
<code>   txout:     02 202cb20600000000 1976a9148280b37df378db99f66f85c95a783a76ac7a6d5988ac</code><br />
<code>                 9093510d00000000 1976a9143bde42dbee7e4dbe6a21b2d50ce2f0167faa815988ac</code><br />
<code>   nLockTime: 11000000</code><br />
<code> </code><br />
<code> The first input comes from an ordinary P2PK:</code><br />
<code>   scriptPubKey : 2103c9f4836b9a4f77fc0d81f7bcb01b7f1b35916864b9476c241ce9fc198bd25432ac value: 6.25</code><br />
<code>   private key  : bbc27228ddcb9209d7fd6f36b02f7dfa6252af40bb2f1cbc7a557da8027ff866</code><br />
<code>   </code><br />
<code> The second input comes from a P2WPKH witness program:</code><br />
<code>   scriptPubKey : 00141d0f172a0ecb48aee1be1f2687d2963ae33f71a1, value: 6</code><br />
<code>   private key  : 619c335025c7f4012e556c2a58b2506e30b8511b53ade95ea316fd8c3286feb9</code><br />
<code>   public key   : 025476c2e83188368da1ff3e292e7acafcdb3566bb0ad253f62fc70f07aeee6357</code><br />
<code>   </code><br />
<code> To sign it with a nHashType of 1 (SIGHASH_ALL):</code><br />
<code> </code><br />
<code> hashPrevouts:</code><br />
<code>   dSHA256(fff7f7881a8099afa6940d42d1e7f6362bec38171ea3edf433541db4e4ad969f00000000ef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a01000000)</code><br />
<code> = 96b827c8483d4e9b96712b6713a7b68d6e8003a781feba36c31143470b4efd37</code><br />
<code> </code><br />
<code> hashSequence:</code><br />
<code>   dSHA256(eeffffffffffffff)</code><br />
<code> = 52b0a642eea2fb7ae638c36f6252b6750293dbe574a806984b8e4d8548339a3b</code><br />
<code> </code><br />
<code> hashOutputs:</code><br />
<code>   dSHA256(202cb206000000001976a9148280b37df378db99f66f85c95a783a76ac7a6d5988ac9093510d000000001976a9143bde42dbee7e4dbe6a21b2d50ce2f0167faa815988ac)</code><br />
<code> = 863ef3e1a92afbfdb97f31ad0fc7683ee943e9abcf2501590ff8f6551f47e5e5</code><br />
<code> </code><br />
<code> hash preimage: 0100000096b827c8483d4e9b96712b6713a7b68d6e8003a781feba36c31143470b4efd3752b0a642eea2fb7ae638c36f6252b6750293dbe574a806984b8e4d8548339a3bef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a010000001976a9141d0f172a0ecb48aee1be1f2687d2963ae33f71a188ac0046c32300000000ffffffff863ef3e1a92afbfdb97f31ad0fc7683ee943e9abcf2501590ff8f6551f47e5e51100000001000000</code><br />
<code> </code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 96b827c8483d4e9b96712b6713a7b68d6e8003a781feba36c31143470b4efd37</code><br />
<code>   hashSequence: 52b0a642eea2fb7ae638c36f6252b6750293dbe574a806984b8e4d8548339a3b</code><br />
<code>   outpoint:     ef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a01000000</code><br />
<code>   scriptCode:   1976a9141d0f172a0ecb48aee1be1f2687d2963ae33f71a188ac</code><br />
<code>   amount:       0046c32300000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  863ef3e1a92afbfdb97f31ad0fc7683ee943e9abcf2501590ff8f6551f47e5e5</code><br />
<code>   nLockTime:    11000000</code><br />
<code>   nHashType:    01000000</code><br />
<code>   </code><br />
<code> sigHash:      c37af31116d1b27caf68aae9e3ac82f1477929014d5b917657d0eb49478cb670</code><br />
<code> signature:    304402203609e17b84f6a7d30c80bfa610b5b4542f32a8a0d5447a12fb1366d7f01cc44a0220573a954c4518331561406f90300e8f3358f51928d43c212a8caed02de67eebee</code><br />
<code>   </code><br />
<code> The serialized signed transaction is: 01000000000102fff7f7881a8099afa6940d42d1e7f6362bec38171ea3edf433541db4e4ad969f00000000494830450221008b9d1dc26ba6a9cb62127b02742fa9d754cd3bebf337f7a55d114c8e5cdd30be022040529b194ba3f9281a99f2b1c0a19c0489bc22ede944ccf4ecbab4cc618ef3ed01eeffffffef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a0100000000ffffffff02202cb206000000001976a9148280b37df378db99f66f85c95a783a76ac7a6d5988ac9093510d000000001976a9143bde42dbee7e4dbe6a21b2d50ce2f0167faa815988ac000247304402203609e17b84f6a7d30c80bfa610b5b4542f32a8a0d5447a12fb1366d7f01cc44a0220573a954c4518331561406f90300e8f3358f51928d43c212a8caed02de67eebee0121025476c2e83188368da1ff3e292e7acafcdb3566bb0ad253f62fc70f07aeee635711000000</code><br />
<code> </code><br />
<code>   nVersion:  01000000</code><br />
<code>   marker:    00</code><br />
<code>   flag:      01</code><br />
<code>   txin:      02 fff7f7881a8099afa6940d42d1e7f6362bec38171ea3edf433541db4e4ad969f 00000000 494830450221008b9d1dc26ba6a9cb62127b02742fa9d754cd3bebf337f7a55d114c8e5cdd30be022040529b194ba3f9281a99f2b1c0a19c0489bc22ede944ccf4ecbab4cc618ef3ed01 eeffffff</code><br />
<code>                 ef51e1b804cc89d182d279655c3aa89e815b1b309fe287d9b2b55d57b90ec68a 01000000 00 ffffffff</code><br />
<code>   txout:     02 202cb20600000000 1976a9148280b37df378db99f66f85c95a783a76ac7a6d5988ac</code><br />
<code>                 9093510d00000000 1976a9143bde42dbee7e4dbe6a21b2d50ce2f0167faa815988ac</code><br />
<code>   witness    00</code><br />
<code>              02 47304402203609e17b84f6a7d30c80bfa610b5b4542f32a8a0d5447a12fb1366d7f01cc44a0220573a954c4518331561406f90300e8f3358f51928d43c212a8caed02de67eebee01 21025476c2e83188368da1ff3e292e7acafcdb3566bb0ad253f62fc70f07aeee6357</code><br />
<code>   nLockTime: 11000000</code></p>
<h3 id="P2SH-P2WPKH">P2SH-P2WPKH</h3>
<p><code> The following is an unsigned transaction: 0100000001db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a54770100000000feffffff02b8b4eb0b000000001976a914a457b684d7f0d539a46a45bbc043f35b59d0d96388ac0008af2f000000001976a914fd270b1ee6abcaea97fea7ad0402e8bd8ad6d77c88ac92040000</code><br />
<code> </code><br />
<code>   nVersion:  01000000</code><br />
<code>   txin:      01 db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a5477 01000000 00 feffffff</code><br />
<code>   txout:     02 b8b4eb0b00000000 1976a914a457b684d7f0d539a46a45bbc043f35b59d0d96388ac</code><br />
<code>                 0008af2f00000000 1976a914fd270b1ee6abcaea97fea7ad0402e8bd8ad6d77c88ac</code><br />
<code>   nLockTime: 92040000</code><br />
<code> </code><br />
<code> The input comes from a P2SH-P2WPKH witness program:</code><br />
<code>   scriptPubKey : a9144733f37cf4db86fbc2efed2500b4f4e49f31202387, value: 10</code><br />
<code>   redeemScript : 001479091972186c449eb1ded22b78e40d009bdf0089</code><br />
<code>   private key  : eb696a065ef48a2192da5b28b694f87544b30fae8327c4510137a922f32c6dcf</code><br />
<code>   public key   : 03ad1d8e89212f0b92c74d23bb710c00662ad1470198ac48c43f7d6f93a2a26873</code><br />
<code> </code><br />
<code> To sign it with a nHashType of 1 (SIGHASH_ALL):</code><br />
<code> </code><br />
<code> hashPrevouts:</code><br />
<code>   dSHA256(db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a547701000000)</code><br />
<code> = b0287b4a252ac05af83d2dcef00ba313af78a3e9c329afa216eb3aa2a7b4613a</code><br />
<code> </code><br />
<code> hashSequence:</code><br />
<code>   dSHA256(feffffff)</code><br />
<code> = 18606b350cd8bf565266bc352f0caddcf01e8fa789dd8a15386327cf8cabe198</code><br />
<code> </code><br />
<code> hashOutputs:</code><br />
<code>   dSHA256(b8b4eb0b000000001976a914a457b684d7f0d539a46a45bbc043f35b59d0d96388ac0008af2f000000001976a914fd270b1ee6abcaea97fea7ad0402e8bd8ad6d77c88ac)</code><br />
<code> = de984f44532e2173ca0d64314fcefe6d30da6f8cf27bafa706da61df8a226c83</code><br />
<code> </code><br />
<code> hash preimage: 01000000b0287b4a252ac05af83d2dcef00ba313af78a3e9c329afa216eb3aa2a7b4613a18606b350cd8bf565266bc352f0caddcf01e8fa789dd8a15386327cf8cabe198db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a5477010000001976a91479091972186c449eb1ded22b78e40d009bdf008988ac00ca9a3b00000000feffffffde984f44532e2173ca0d64314fcefe6d30da6f8cf27bafa706da61df8a226c839204000001000000</code><br />
<code> </code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: b0287b4a252ac05af83d2dcef00ba313af78a3e9c329afa216eb3aa2a7b4613a</code><br />
<code>   hashSequence: 18606b350cd8bf565266bc352f0caddcf01e8fa789dd8a15386327cf8cabe198</code><br />
<code>   outpoint:     db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a547701000000</code><br />
<code>   scriptCode:   1976a91479091972186c449eb1ded22b78e40d009bdf008988ac</code><br />
<code>   amount:       00ca9a3b00000000</code><br />
<code>   nSequence:    feffffff</code><br />
<code>   hashOutputs:  de984f44532e2173ca0d64314fcefe6d30da6f8cf27bafa706da61df8a226c83</code><br />
<code>   nLockTime:    92040000</code><br />
<code>   nHashType:    01000000</code><br />
<code> </code><br />
<code> sigHash:      64f3b0f4dd2bb3aa1ce8566d220cc74dda9df97d8490cc81d89d735c92e59fb6</code><br />
<code> signature:    3044022047ac8e878352d3ebbde1c94ce3a10d057c24175747116f8288e5d794d12d482f0220217f36a485cae903c713331d877c1f64677e3622ad4010726870540656fe9dcb01</code><br />
<code> </code><br />
<code> The serialized signed transaction is: 01000000000101db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a5477010000001716001479091972186c449eb1ded22b78e40d009bdf0089feffffff02b8b4eb0b000000001976a914a457b684d7f0d539a46a45bbc043f35b59d0d96388ac0008af2f000000001976a914fd270b1ee6abcaea97fea7ad0402e8bd8ad6d77c88ac02473044022047ac8e878352d3ebbde1c94ce3a10d057c24175747116f8288e5d794d12d482f0220217f36a485cae903c713331d877c1f64677e3622ad4010726870540656fe9dcb012103ad1d8e89212f0b92c74d23bb710c00662ad1470198ac48c43f7d6f93a2a2687392040000</code><br />
<code>   nVersion:  01000000</code><br />
<code>   marker:    00</code><br />
<code>   flag:      01</code><br />
<code>   txin:      01 db6b1b20aa0fd7b23880be2ecbd4a98130974cf4748fb66092ac4d3ceb1a5477 01000000 1716001479091972186c449eb1ded22b78e40d009bdf0089 feffffff</code><br />
<code>   txout:     02 b8b4eb0b00000000 1976a914a457b684d7f0d539a46a45bbc043f35b59d0d96388ac</code><br />
<code>                 0008af2f00000000 1976a914fd270b1ee6abcaea97fea7ad0402e8bd8ad6d77c88ac</code><br />
<code>   witness    02 473044022047ac8e878352d3ebbde1c94ce3a10d057c24175747116f8288e5d794d12d482f0220217f36a485cae903c713331d877c1f64677e3622ad4010726870540656fe9dcb01 2103ad1d8e89212f0b92c74d23bb710c00662ad1470198ac48c43f7d6f93a2a26873</code><br />
<code>   nLockTime: 92040000</code></p>
<h3 id="Native_P2WSH">Native P2WSH</h3>
<p>This example shows how <code>OP_CODESEPARATOR</code> and out-of-range
<code>SIGHASH_SINGLE</code> are processed:</p>
<p><code> The following is an unsigned transaction:</code><br />
<code>   0100000002fe3dc9208094f3ffd12645477b3dc56f60ec4fa8e6f5d67c565d1c6b9216b36e0000000000ffffffff0815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f80000000000ffffffff0100f2052a010000001976a914a30741f8145e5acadf23f751864167f32e0963f788ac00000000</code><br />
<code> </code><br />
<code>   nVersion:  01000000</code><br />
<code>   txin:      02 fe3dc9208094f3ffd12645477b3dc56f60ec4fa8e6f5d67c565d1c6b9216b36e 00000000 00 ffffffff</code><br />
<code>                 0815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f8 00000000 00 ffffffff</code><br />
<code>   txout:     01 00f2052a01000000 1976a914a30741f8145e5acadf23f751864167f32e0963f788ac</code><br />
<code>   nLockTime: 00000000</code><br />
<code> </code><br />
<code> The first input comes from an ordinary P2PK:</code><br />
<code>   scriptPubKey: 21036d5c20fa14fb2f635474c1dc4ef5909d4568e5569b79fc94d3448486e14685f8ac value: 1.5625</code><br />
<code>   private key:  b8f28a772fccbf9b4f58a4f027e07dc2e35e7cd80529975e292ea34f84c4580c</code><br />
<code>   signature:    304402200af4e47c9b9629dbecc21f73af989bdaa911f7e6f6c2e9394588a3aa68f81e9902204f3fcf6ade7e5abb1295b6774c8e0abd94ae62217367096bc02ee5e435b67da201 (SIGHASH_ALL)</code><br />
<code> </code><br />
<code> The second input comes from a native P2WSH witness program:</code><br />
<code>   scriptPubKey : 00205d1b56b63d714eebe542309525f484b7e9d6f686b3781b6f61ef925d66d6f6a0, value: 49</code><br />
<code>   witnessScript: 21026dccc749adc2a9d0d89497ac511f760f45c47dc5ed9cf352a58ac706453880aeadab210255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465ac</code><br />
<code>                  &lt;026dccc749adc2a9d0d89497ac511f760f45c47dc5ed9cf352a58ac706453880ae&gt; CHECKSIGVERIFY CODESEPARATOR &lt;0255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465&gt; CHECKSIG</code><br />
<code> </code><br />
<code> To sign it with a nHashType of 3 (SIGHASH_SINGLE):</code><br />
<code> </code><br />
<code> hashPrevouts:</code><br />
<code>   dSHA256(fe3dc9208094f3ffd12645477b3dc56f60ec4fa8e6f5d67c565d1c6b9216b36e000000000815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f800000000)</code><br />
<code> = ef546acf4a020de3898d1b8956176bb507e6211b5ed3619cd08b6ea7e2a09d41</code><br />
<code> </code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: ef546acf4a020de3898d1b8956176bb507e6211b5ed3619cd08b6ea7e2a09d41</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     0815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f800000000</code><br />
<code>   scriptCode:   (see below)</code><br />
<code>   amount:       0011102401000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  0000000000000000000000000000000000000000000000000000000000000000 (this is the second input but there is only one output)</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    03000000</code><br />
<code> </code><br />
<code> scriptCode:  4721026dccc749adc2a9d0d89497ac511f760f45c47dc5ed9cf352a58ac706453880aeadab210255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465ac</code><br />
<code>                                                                                      ^^</code><br />
<code>              (please note that the not-yet-executed OP_CODESEPARATOR is not removed from the scriptCode)</code><br />
<code> preimage:    01000000ef546acf4a020de3898d1b8956176bb507e6211b5ed3619cd08b6ea7e2a09d4100000000000000000000000000000000000000000000000000000000000000000815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f8000000004721026dccc749adc2a9d0d89497ac511f760f45c47dc5ed9cf352a58ac706453880aeadab210255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465ac0011102401000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000003000000</code><br />
<code> sigHash:     82dde6e4f1e94d02c2b7ad03d2115d691f48d064e9d52f58194a6637e4194391</code><br />
<code> public key:  026dccc749adc2a9d0d89497ac511f760f45c47dc5ed9cf352a58ac706453880ae</code><br />
<code> private key: 8e02b539b1500aa7c81cf3fed177448a546f19d2be416c0c61ff28e577d8d0cd</code><br />
<code> signature:   3044022027dc95ad6b740fe5129e7e62a75dd00f291a2aeb1200b84b09d9e3789406b6c002201a9ecd315dd6a0e632ab20bbb98948bc0c6fb204f2c286963bb48517a7058e2703</code><br />
<code> </code><br />
<code> scriptCode:  23210255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465ac</code><br />
<code>              (everything up to the last executed OP_CODESEPARATOR, including that OP_CODESEPARATOR, are removed)</code><br />
<code> preimage:    01000000ef546acf4a020de3898d1b8956176bb507e6211b5ed3619cd08b6ea7e2a09d4100000000000000000000000000000000000000000000000000000000000000000815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f80000000023210255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465ac0011102401000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000003000000</code><br />
<code> sigHash:     fef7bd749cce710c5c052bd796df1af0d935e59cea63736268bcbe2d2134fc47</code><br />
<code> public key:  0255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465</code><br />
<code> private key: 86bf2ed75935a0cbef03b89d72034bb4c189d381037a5ac121a70016db8896ec</code><br />
<code> signature:   304402200de66acf4527789bfda55fc5459e214fa6083f936b430a762c629656216805ac0220396f550692cd347171cbc1ef1f51e15282e837bb2b30860dc77c8f78bc8501e503</code><br />
<code> </code><br />
<code> The serialized signed transaction is: 01000000000102fe3dc9208094f3ffd12645477b3dc56f60ec4fa8e6f5d67c565d1c6b9216b36e000000004847304402200af4e47c9b9629dbecc21f73af989bdaa911f7e6f6c2e9394588a3aa68f81e9902204f3fcf6ade7e5abb1295b6774c8e0abd94ae62217367096bc02ee5e435b67da201ffffffff0815cf020f013ed6cf91d29f4202e8a58726b1ac6c79da47c23d1bee0a6925f80000000000ffffffff0100f2052a010000001976a914a30741f8145e5acadf23f751864167f32e0963f788ac000347304402200de66acf4527789bfda55fc5459e214fa6083f936b430a762c629656216805ac0220396f550692cd347171cbc1ef1f51e15282e837bb2b30860dc77c8f78bc8501e503473044022027dc95ad6b740fe5129e7e62a75dd00f291a2aeb1200b84b09d9e3789406b6c002201a9ecd315dd6a0e632ab20bbb98948bc0c6fb204f2c286963bb48517a7058e27034721026dccc749adc2a9d0d89497ac511f760f45c47dc5ed9cf352a58ac706453880aeadab210255a9626aebf5e29c0e6538428ba0d1dcf6ca98ffdf086aa8ced5e0d0215ea465ac00000000</code></p>
<p>This example shows how unexecuted <code>OP_CODESEPARATOR</code> is processed, and
<code>SINGLE|ANYONECANPAY</code> does not commit to the input index:</p>
<p><code> The following is an unsigned transaction:</code><br />
<code>   0100000002e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc0010000000000ffffffff80e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b0000000000ffffffff0280969800000000001976a914de4b231626ef508c9a74a8517e6783c0546d6b2888ac80969800000000001976a9146648a8cd4531e1ec47f35916de8e259237294d1e88ac00000000</code><br />
<code> </code><br />
<code>   nVersion:  01000000</code><br />
<code>   txin:      02 e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc001 00000000 00 ffffffff</code><br />
<code>                 80e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b 00000000 00 ffffffff</code><br />
<code>   txout:     02 8096980000000000 1976a914de4b231626ef508c9a74a8517e6783c0546d6b2888ac</code><br />
<code>                 8096980000000000 1976a9146648a8cd4531e1ec47f35916de8e259237294d1e88ac</code><br />
<code>   nLockTime: 00000000</code><br />
<code> </code><br />
<code> The first input comes from a native P2WSH witness program:</code><br />
<code>   scriptPubKey: 0020ba468eea561b26301e4cf69fa34bde4ad60c81e70f059f045ca9a79931004a4d value: 0.16777215</code><br />
<code>   witnessScript:0063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>                 0 IF CODESEPARATOR ENDIF &lt;0392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98&gt; CHECKSIG</code><br />
<code> </code><br />
<code> The second input comes from a native P2WSH witness program:</code><br />
<code>   scriptPubKey: 0020d9bbfbe56af7c4b7f960a70d7ea107156913d9e5a26b0a71429df5e097ca6537 value: 0.16777215</code><br />
<code>   witnessScript:5163ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>                 1 IF CODESEPARATOR ENDIF &lt;0392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98&gt; CHECKSIG</code><br />
<code> </code><br />
<code> To sign it with a nHashType of 0x83 (SINGLE|ANYONECANPAY):</code><br />
<code> </code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     (see below)</code><br />
<code>   scriptCode:   (see below)</code><br />
<code>   amount:       ffffff0000000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  (see below)</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    83000000</code><br />
<code> </code><br />
<code> outpoint:    e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc00100000000</code><br />
<code> scriptCode:  270063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>              (since the OP_CODESEPARATOR is not executed, nothing is removed from the scriptCode)</code><br />
<code> hashOutputs: b258eaf08c39fbe9fbac97c15c7e7adeb8df142b0df6f83e017f349c2b6fe3d2</code><br />
<code> preimage:    0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc00100000000270063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98acffffff0000000000ffffffffb258eaf08c39fbe9fbac97c15c7e7adeb8df142b0df6f83e017f349c2b6fe3d20000000083000000</code><br />
<code> sigHash:     e9071e75e25b8a1e298a72f0d2e9f4f95a0f5cdf86a533cda597eb402ed13b3a</code><br />
<code> public key:  0392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98</code><br />
<code> private key: f52b3484edd96598e02a9c89c4492e9c1e2031f471c49fd721fe68b3ce37780d</code><br />
<code> signature:   3045022100f6a10b8604e6dc910194b79ccfc93e1bc0ec7c03453caaa8987f7d6c3413566002206216229ede9b4d6ec2d325be245c5b508ff0339bf1794078e20bfe0babc7ffe683</code><br />
<code> </code><br />
<code> outpoint:    80e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b00000000</code><br />
<code> scriptCode:  2468210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>              (everything up to the last executed OP_CODESEPARATOR, including that OP_CODESEPARATOR, are removed)</code><br />
<code> hashOutputs: 91ea93dd77f702b738ebdbf3048940a98310e869a7bb8fa2c6cb3312916947ca</code><br />
<code> preimage:    010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b000000002468210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98acffffff0000000000ffffffff91ea93dd77f702b738ebdbf3048940a98310e869a7bb8fa2c6cb3312916947ca0000000083000000</code><br />
<code> sigHash:     cd72f1f1a433ee9df816857fad88d8ebd97e09a75cd481583eb841c330275e54</code><br />
<code> public key:  0392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98</code><br />
<code> private key: f52b3484edd96598e02a9c89c4492e9c1e2031f471c49fd721fe68b3ce37780d</code><br />
<code> signature:   30440220032521802a76ad7bf74d0e2c218b72cf0cbc867066e2e53db905ba37f130397e02207709e2188ed7f08f4c952d9d13986da504502b8c3be59617e043552f506c46ff83</code><br />
<code> </code><br />
<code> The serialized signed transaction is:</code><br />
<code> 01000000000102e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc0010000000000ffffffff80e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b0000000000ffffffff0280969800000000001976a914de4b231626ef508c9a74a8517e6783c0546d6b2888ac80969800000000001976a9146648a8cd4531e1ec47f35916de8e259237294d1e88ac02483045022100f6a10b8604e6dc910194b79ccfc93e1bc0ec7c03453caaa8987f7d6c3413566002206216229ede9b4d6ec2d325be245c5b508ff0339bf1794078e20bfe0babc7ffe683270063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac024730440220032521802a76ad7bf74d0e2c218b72cf0cbc867066e2e53db905ba37f130397e02207709e2188ed7f08f4c952d9d13986da504502b8c3be59617e043552f506c46ff83275163ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac00000000</code><br />
<code>   nVersion:  01000000</code><br />
<code>   marker:    00</code><br />
<code>   flag:      01</code><br />
<code>   txin:      02 e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc001 00000000 00 ffffffff</code><br />
<code>                 80e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b 00000000 00 ffffffff</code><br />
<code>   txout:     02 8096980000000000 1976a914de4b231626ef508c9a74a8517e6783c0546d6b2888ac</code><br />
<code>                 8096980000000000 1976a9146648a8cd4531e1ec47f35916de8e259237294d1e88ac</code><br />
<code>   witness    02 483045022100f6a10b8604e6dc910194b79ccfc93e1bc0ec7c03453caaa8987f7d6c3413566002206216229ede9b4d6ec2d325be245c5b508ff0339bf1794078e20bfe0babc7ffe683 270063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>              02 4730440220032521802a76ad7bf74d0e2c218b72cf0cbc867066e2e53db905ba37f130397e02207709e2188ed7f08f4c952d9d13986da504502b8c3be59617e043552f506c46ff83 275163ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>   nLockTime: 00000000</code><br />
<code> </code><br />
<code> Since SINGLE|ANYONECANPAY does not commit to the input index, the signatures are still valid when the input-output pairs are swapped:</code><br />
<code> 0100000000010280e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b0000000000ffffffffe9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc0010000000000ffffffff0280969800000000001976a9146648a8cd4531e1ec47f35916de8e259237294d1e88ac80969800000000001976a914de4b231626ef508c9a74a8517e6783c0546d6b2888ac024730440220032521802a76ad7bf74d0e2c218b72cf0cbc867066e2e53db905ba37f130397e02207709e2188ed7f08f4c952d9d13986da504502b8c3be59617e043552f506c46ff83275163ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac02483045022100f6a10b8604e6dc910194b79ccfc93e1bc0ec7c03453caaa8987f7d6c3413566002206216229ede9b4d6ec2d325be245c5b508ff0339bf1794078e20bfe0babc7ffe683270063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac00000000</code><br />
<code>   nVersion:  01000000</code><br />
<code>   marker:    00</code><br />
<code>   flag:      01</code><br />
<code>   txin:      02 80e68831516392fcd100d186b3c2c7b95c80b53c77e77c35ba03a66b429a2a1b 00000000 00 ffffffff</code><br />
<code>                 e9b542c5176808107ff1df906f46bb1f2583b16112b95ee5380665ba7fcfc001 00000000 00 ffffffff</code><br />
<code>   txout:     02 8096980000000000 1976a9146648a8cd4531e1ec47f35916de8e259237294d1e88ac</code><br />
<code>                 8096980000000000 1976a914de4b231626ef508c9a74a8517e6783c0546d6b2888ac</code><br />
<code>   witness    02 4730440220032521802a76ad7bf74d0e2c218b72cf0cbc867066e2e53db905ba37f130397e02207709e2188ed7f08f4c952d9d13986da504502b8c3be59617e043552f506c46ff83 275163ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>              02 483045022100f6a10b8604e6dc910194b79ccfc93e1bc0ec7c03453caaa8987f7d6c3413566002206216229ede9b4d6ec2d325be245c5b508ff0339bf1794078e20bfe0babc7ffe683 270063ab68210392972e2eb617b2388771abe27235fd5ac44af8e61693261550447a4c3e39da98ac</code><br />
<code>   nLockTime: 00000000</code></p>
<h3 id="P2SH-P2WSH">P2SH-P2WSH</h3>
<p>This example is a P2SH-P2WSH 6-of-6 multisig witness program signed with
6 different <code>SIGHASH</code> types.</p>
<p><code> The following is an unsigned transaction: 010000000136641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e0100000000ffffffff0200e9a435000000001976a914389ffce9cd9ae88dcc0631e88a821ffdbe9bfe2688acc0832f05000000001976a9147480a33f950689af511e6e84c138dbbd3c3ee41588ac00000000</code><br />
<code> </code><br />
<code>   nVersion:  01000000</code><br />
<code>   txin:      01 36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e 01000000 00 ffffffff</code><br />
<code>   txout:     02 00e9a43500000000 1976a914389ffce9cd9ae88dcc0631e88a821ffdbe9bfe2688ac</code><br />
<code>                 c0832f0500000000 1976a9147480a33f950689af511e6e84c138dbbd3c3ee41588ac</code><br />
<code>   nLockTime: 00000000</code><br />
<code> </code><br />
<code> The input comes from a P2SH-P2WSH 6-of-6 multisig witness program:</code><br />
<code>   scriptPubKey : a9149993a429037b5d912407a71c252019287b8d27a587, value: 9.87654321</code><br />
<code>   redeemScript : 0020a16b5755f7f6f96dbd65f5f0d6ab9418b89af4b1f14a1bb8a09062c35f0dcb54</code><br />
<code>   witnessScript: 56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code> </code><br />
<code> hashPrevouts:</code><br />
<code>   dSHA256(36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000)</code><br />
<code> = 74afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa0</code><br />
<code> </code><br />
<code> hashSequence:</code><br />
<code>   dSHA256(ffffffff)</code><br />
<code> = 3bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e70665044</code><br />
<code> </code><br />
<code> hashOutputs for ALL:</code><br />
<code>   dSHA256(00e9a435000000001976a914389ffce9cd9ae88dcc0631e88a821ffdbe9bfe2688acc0832f05000000001976a9147480a33f950689af511e6e84c138dbbd3c3ee41588ac)</code><br />
<code> = bc4d309071414bed932f98832b27b4d76dad7e6c1346f487a8fdbb8eb90307cc</code><br />
<code> </code><br />
<code> hashOutputs for SINGLE:</code><br />
<code>   dSHA256(00e9a435000000001976a914389ffce9cd9ae88dcc0631e88a821ffdbe9bfe2688ac)</code><br />
<code> = 9efe0c13a6b16c14a41b04ebe6a63f419bdacb2f8705b494a43063ca3cd4f708</code><br />
<code> </code><br />
<code> hash preimage for ALL: 0100000074afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa03bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e7066504436641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56aeb168de3a00000000ffffffffbc4d309071414bed932f98832b27b4d76dad7e6c1346f487a8fdbb8eb90307cc0000000001000000</code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 74afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa0</code><br />
<code>   hashSequence: 3bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e70665044</code><br />
<code>   outpoint:     36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000</code><br />
<code>   scriptCode:   cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code>   amount:       b168de3a00000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  bc4d309071414bed932f98832b27b4d76dad7e6c1346f487a8fdbb8eb90307cc</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    01000000</code><br />
<code> sigHash:      185c0be5263dce5b4bb50a047973c1b6272bfbd0103a89444597dc40b248ee7c</code><br />
<code> public key:   0307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba3</code><br />
<code> private key:  730fff80e1413068a05b57d6a58261f07551163369787f349438ea38ca80fac6</code><br />
<code> signature:    304402206ac44d672dac41f9b00e28f4df20c52eeb087207e8d758d76d92c6fab3b73e2b0220367750dbbe19290069cba53d096f44530e4f98acaa594810388cf7409a1870ce01</code><br />
<code> </code><br />
<code> hash preimage for NONE: 0100000074afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa0000000000000000000000000000000000000000000000000000000000000000036641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56aeb168de3a00000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000002000000</code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 74afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa0</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000</code><br />
<code>   scriptCode:   cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code>   amount:       b168de3a00000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    02000000</code><br />
<code> sigHash:        e9733bc60ea13c95c6527066bb975a2ff29a925e80aa14c213f686cbae5d2f36</code><br />
<code> public key:     03b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b</code><br />
<code> private key:    11fa3d25a17cbc22b29c44a484ba552b5a53149d106d3d853e22fdd05a2d8bb3</code><br />
<code> signature:      3044022068c7946a43232757cbdf9176f009a928e1cd9a1a8c212f15c1e11ac9f2925d9002205b75f937ff2f9f3c1246e547e54f62e027f64eefa2695578cc6432cdabce271502</code><br />
<code> </code><br />
<code> hash preimage for SINGLE: 0100000074afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa0000000000000000000000000000000000000000000000000000000000000000036641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56aeb168de3a00000000ffffffff9efe0c13a6b16c14a41b04ebe6a63f419bdacb2f8705b494a43063ca3cd4f7080000000003000000</code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 74afdc312af5183c4198a40ca3c1a275b485496dd3929bca388c4b5e31f7aaa0</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000</code><br />
<code>   scriptCode:   cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code>   amount:       b168de3a00000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  9efe0c13a6b16c14a41b04ebe6a63f419bdacb2f8705b494a43063ca3cd4f708</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    03000000</code><br />
<code> sigHash:        1e1f1c303dc025bd664acb72e583e933fae4cff9148bf78c157d1e8f78530aea</code><br />
<code> public key:     034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a</code><br />
<code> private key:    77bf4141a87d55bdd7f3cd0bdccf6e9e642935fec45f2f30047be7b799120661</code><br />
<code> signature:      3044022059ebf56d98010a932cf8ecfec54c48e6139ed6adb0728c09cbe1e4fa0915302e022007cd986c8fa870ff5d2b3a89139c9fe7e499259875357e20fcbb15571c76795403</code><br />
<code> </code><br />
<code> hash preimage for ALL|ANYONECANPAY: 010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56aeb168de3a00000000ffffffffbc4d309071414bed932f98832b27b4d76dad7e6c1346f487a8fdbb8eb90307cc0000000081000000</code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000</code><br />
<code>   scriptCode:   cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code>   amount:       b168de3a00000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  bc4d309071414bed932f98832b27b4d76dad7e6c1346f487a8fdbb8eb90307cc</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    81000000</code><br />
<code> sigHash:        2a67f03e63a6a422125878b40b82da593be8d4efaafe88ee528af6e5a9955c6e</code><br />
<code> public key:     033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f4</code><br />
<code> private key:    14af36970f5025ea3e8b5542c0f8ebe7763e674838d08808896b63c3351ffe49</code><br />
<code> signature:      3045022100fbefd94bd0a488d50b79102b5dad4ab6ced30c4069f1eaa69a4b5a763414067e02203156c6a5c9cf88f91265f5a942e96213afae16d83321c8b31bb342142a14d16381</code><br />
<code> </code><br />
<code> hash preimage for NONE|ANYONECANPAY: 010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56aeb168de3a00000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000082000000</code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000</code><br />
<code>   scriptCode:   cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code>   amount:       b168de3a00000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    82000000</code><br />
<code> sigHash:        781ba15f3779d5542ce8ecb5c18716733a5ee42a6f51488ec96154934e2c890a</code><br />
<code> public key:     03a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac16</code><br />
<code> private key:    fe9a95c19eef81dde2b95c1284ef39be497d128e2aa46916fb02d552485e0323</code><br />
<code> signature:      3045022100a5263ea0553ba89221984bd7f0b13613db16e7a70c549a86de0cc0444141a407022005c360ef0ae5a5d4f9f2f87a56c1546cc8268cab08c73501d6b3be2e1e1a8a0882</code><br />
<code> </code><br />
<code> hash preimage for SINGLE|ANYONECANPAY: 010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56aeb168de3a00000000ffffffff9efe0c13a6b16c14a41b04ebe6a63f419bdacb2f8705b494a43063ca3cd4f7080000000083000000</code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   hashSequence: 0000000000000000000000000000000000000000000000000000000000000000</code><br />
<code>   outpoint:     36641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e01000000</code><br />
<code>   scriptCode:   cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae</code><br />
<code>   amount:       b168de3a00000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  9efe0c13a6b16c14a41b04ebe6a63f419bdacb2f8705b494a43063ca3cd4f708</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    83000000</code><br />
<code> sigHash:        511e8e52ed574121fc1b654970395502128263f62662e076dc6baf05c2e6a99b</code><br />
<code> public key:     02d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b</code><br />
<code> private key:    428a7aee9f0c2af0cd19af3cf1c78149951ea528726989b2e83e4778d2c3f890</code><br />
<code> signature:      30440220525406a1482936d5a21888260dc165497a90a15669636d8edca6b9fe490d309c022032af0c646a34a44d1f4576bf6a4a74b67940f8faa84c7df9abe12a01a11e2b4783</code><br />
<code> </code><br />
<code> The serialized signed transaction is: 0100000000010136641869ca081e70f394c6948e8af409e18b619df2ed74aa106c1ca29787b96e0100000023220020a16b5755f7f6f96dbd65f5f0d6ab9418b89af4b1f14a1bb8a09062c35f0dcb54ffffffff0200e9a435000000001976a914389ffce9cd9ae88dcc0631e88a821ffdbe9bfe2688acc0832f05000000001976a9147480a33f950689af511e6e84c138dbbd3c3ee41588ac080047304402206ac44d672dac41f9b00e28f4df20c52eeb087207e8d758d76d92c6fab3b73e2b0220367750dbbe19290069cba53d096f44530e4f98acaa594810388cf7409a1870ce01473044022068c7946a43232757cbdf9176f009a928e1cd9a1a8c212f15c1e11ac9f2925d9002205b75f937ff2f9f3c1246e547e54f62e027f64eefa2695578cc6432cdabce271502473044022059ebf56d98010a932cf8ecfec54c48e6139ed6adb0728c09cbe1e4fa0915302e022007cd986c8fa870ff5d2b3a89139c9fe7e499259875357e20fcbb15571c76795403483045022100fbefd94bd0a488d50b79102b5dad4ab6ced30c4069f1eaa69a4b5a763414067e02203156c6a5c9cf88f91265f5a942e96213afae16d83321c8b31bb342142a14d16381483045022100a5263ea0553ba89221984bd7f0b13613db16e7a70c549a86de0cc0444141a407022005c360ef0ae5a5d4f9f2f87a56c1546cc8268cab08c73501d6b3be2e1e1a8a08824730440220525406a1482936d5a21888260dc165497a90a15669636d8edca6b9fe490d309c022032af0c646a34a44d1f4576bf6a4a74b67940f8faa84c7df9abe12a01a11e2b4783cf56210307b8ae49ac90a048e9b53357a2354b3334e9c8bee813ecb98e99a7e07e8c3ba32103b28f0c28bfab54554ae8c658ac5c3e0ce6e79ad336331f78c428dd43eea8449b21034b8113d703413d57761b8b9781957b8c0ac1dfe69f492580ca4195f50376ba4a21033400f6afecb833092a9a21cfdf1ed1376e58c5d1f47de74683123987e967a8f42103a6d48b1131e94ba04d9737d61acdaa1322008af9602b3b14862c07a1789aac162102d8b661b0b3302ee2f162b09e07a55ad5dfbe673a9f01d9f0c19617681024306b56ae00000000</code></p>
<h3 id="No_FindAndDelete">No FindAndDelete</h3>
<p>These examples show that <code>FindAndDelete</code> for the signature is not
applied. The transactions are generated in an unconventional way.
Instead of signing using a private key, the signatures are
pre-determined as part of <code>witnessScript</code>. The public keys are generated
with key recovery, using the fixed signatures and the <code>sighash</code> defined
in this proposal. Therefore, the private keys are unknown.</p>
<p><code> The following is an unsigned transaction: 010000000169c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f14c1d000000ffffffff0101000000000000000000000000</code><br />
<code> </code><br />
<code>   nVersion:  01000000</code><br />
<code>   txin:      01 69c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f1 4c1d0000 00 ffffffff</code><br />
<code>   txout:     01 0100000000000000 00</code><br />
<code>   nLockTime: 00000000</code><br />
<code> </code><br />
<code> The input comes from a P2WSH witness program:</code><br />
<code>   scriptPubKey : 00209e1be07558ea5cc8e02ed1d80c0911048afad949affa36d5c3951e3159dbea19, value: 200000</code><br />
<code>   redeemScript : OP_CHECKSIGVERIFY &lt;0x30450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01&gt;</code><br />
<code>                  ad4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01</code><br />
<code> </code><br />
<code> To sign it with a nHashType of 1 (SIGHASH_ALL):</code><br />
<code> </code><br />
<code> hashPrevouts:</code><br />
<code>   dSHA256(69c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f14c1d0000)</code><br />
<code> = b67c76d200c6ce72962d919dc107884b9d5d0e26f2aea7474b46a1904c53359f</code><br />
<code> </code><br />
<code> hashSequence:</code><br />
<code>   dSHA256(ffffffff)</code><br />
<code> = 3bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e70665044</code><br />
<code> </code><br />
<code> hashOutputs:</code><br />
<code>   dSHA256(010000000000000000)</code><br />
<code> = e5d196bfb21caca9dbd654cafb3b4dc0c4882c8927d2eb300d9539dd0b934228</code><br />
<code> </code><br />
<code> hash preimage: 01000000b67c76d200c6ce72962d919dc107884b9d5d0e26f2aea7474b46a1904c53359f3bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e7066504469c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f14c1d00004aad4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01400d030000000000ffffffffe5d196bfb21caca9dbd654cafb3b4dc0c4882c8927d2eb300d9539dd0b9342280000000001000000</code><br />
<code> </code><br />
<code>   nVersion:     01000000</code><br />
<code>   hashPrevouts: b67c76d200c6ce72962d919dc107884b9d5d0e26f2aea7474b46a1904c53359f</code><br />
<code>   hashSequence: 3bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e70665044</code><br />
<code>   outpoint:     69c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f14c1d0000</code><br />
<code>   scriptCode:   4aad4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01</code><br />
<code>   amount:       400d030000000000</code><br />
<code>   nSequence:    ffffffff</code><br />
<code>   hashOutputs:  e5d196bfb21caca9dbd654cafb3b4dc0c4882c8927d2eb300d9539dd0b934228</code><br />
<code>   nLockTime:    00000000</code><br />
<code>   nHashType:    01000000</code><br />
<code> </code><br />
<code> sigHash:      71c9cd9b2869b9c70b01b1f0360c148f42dee72297db312638df136f43311f23</code><br />
<code> signature:    30450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e 01</code><br />
<code> pubkey:       02a9781d66b61fb5a7ef00ac5ad5bc6ffc78be7b44a566e3c87870e1079368df4c</code><br />
<code> </code><br />
<code> The serialized signed transaction is: 0100000000010169c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f14c1d000000ffffffff01010000000000000000034830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e012102a9781d66b61fb5a7ef00ac5ad5bc6ffc78be7b44a566e3c87870e1079368df4c4aad4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0100000000</code></p>
<p><code>   nVersion:  01000000</code><br />
<code>   marker:    00</code><br />
<code>   flag:      01</code><br />
<code>   txin:      01 69c12106097dc2e0526493ef67f21269fe888ef05c7a3a5dacab38e1ac8387f1 4c1d0000 00 ffffffff</code><br />
<code>   txout:     01 0100000000000000 00</code><br />
<code>   witness:   03 4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01</code><br />
<code>                 2102a9781d66b61fb5a7ef00ac5ad5bc6ffc78be7b44a566e3c87870e1079368df4c</code><br />
<code>                 4aad4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01</code><br />
<code>   nLockTime: 00000000</code><br />
<code> </code></p>
<p><code> The following transaction is a ``OP_CHECKMULTISIGVERIFY`` version of the ``FindAndDelete`` examples: 010000000001019275cb8d4a485ce95741c013f7c0d28722160008021bb469a11982d47a6628964c1d000000ffffffff0101000000000000000007004830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0148304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c0395960101022102966f109c54e85d3aee8321301136cedeb9fc710fdef58a9de8a73942f8e567c021034ffc99dd9a79dd3cb31e2ab3e0b09e0e67db41ac068c625cd1f491576016c84e9552af4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0148304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c039596017500000000</code><br />
<code> </code><br />
<code> redeemScript:  OP_2 OP_CHECKMULTISIGVERIFY &lt;30450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01&gt; &lt;304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c03959601&gt;</code><br />
<code> hash preimage: 0100000039283953eb1e26994dde57b7f9362a79a8c523e2f8deba943c27e826a005f1e63bb13029ce7b1f559ef5e747fcac439f1455a2ec7c5f09b72290795e706650449275cb8d4a485ce95741c013f7c0d28722160008021bb469a11982d47a6628964c1d00009552af4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0148304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c0395960175400d030000000000ffffffffe5d196bfb21caca9dbd654cafb3b4dc0c4882c8927d2eb300d9539dd0b9342280000000001000000</code><br />
<code> sighash:       c1628a1e7c67f14ca0c27c06e4fdeec2e6d1a73c7a91d7c046ff83e835aebb72</code><br />
<code> witness:       07 00</code><br />
<code>                   4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e01</code><br />
<code>                   48304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c03959601</code><br />
<code>                   0102</code><br />
<code>                   2102966f109c54e85d3aee8321301136cedeb9fc710fdef58a9de8a73942f8e567c0</code><br />
<code>                   21034ffc99dd9a79dd3cb31e2ab3e0b09e0e67db41ac068c625cd1f491576016c84e</code><br />
<code>                   9552af4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0148304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c0395960175</code></p>
<p>The new serialization format is described in BIP144 <sup class="footnote-reference"><a href="#9">9</a></sup></p>
<h2 id="Deployment">Deployment</h2>
<p>This proposal is deployed with Segregated Witness softfork (BIP 141)</p>
<h2 id="Backward_compatibility">Backward compatibility</h2>
<p>As a soft fork, older software will continue to operate without
modification. Non-upgraded nodes, however, will not see nor validate the
witness data and will consider all witness programs, including the
redefined sigops, as anyone-can-spend scripts.</p>
<h2 id="Reference_Implementation">Reference Implementation</h2>
<p><a rel="noopener" target="_blank" href="https://github.com/bitcoin/bitcoin/pull/8149">https://github.com/bitcoin/bitcoin/pull/8149</a></p>
<h2 id="References">References</h2>
<references />
<h2 id="Copyright">Copyright</h2>
<p>This document is placed in the public domain.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a rel="noopener" target="_blank" href="https://en.bitcoin.it/wiki/OP_CHECKSIG">1</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a rel="noopener" target="_blank" href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-2292">CVE-2013-2292</a></p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">3</sup>
<p><a rel="noopener" target="_blank" href="https://bitcointalk.org/?topic=140078">New Bitcoin vulnerability: A transaction that takes at least 3
minutes to verify</a></p>
</div>
<div class="footnote-definition" id="4"><sup class="footnote-definition-label">4</sup>
<p><a rel="noopener" target="_blank" href="http://rusty.ozlabs.org/?p=522">The Megatransaction: Why Does It Take 25
Seconds?</a></p>
</div>
<div class="footnote-definition" id="5"><sup class="footnote-definition-label">5</sup>
<p><a rel="noopener" target="_blank" href="https://bitcointalk.org/index.php?topic=181734.0">SIGHASH_WITHINPUTVALUE: Super-lightweight HW wallets and offline
data</a></p>
</div>
<div class="footnote-definition" id="6"><sup class="footnote-definition-label">6</sup>
<p><a rel="noopener" target="_blank" href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki">BIP141: Segregated Witness (Consensus
layer)</a></p>
</div>
<div class="footnote-definition" id="7"><sup class="footnote-definition-label">7</sup></div>
<div class="footnote-definition" id="8"><sup class="footnote-definition-label">8</sup>
<p>In the original algorithm, a <code>uint256</code> of <code>0x0000......0001</code> is
committed if the input index for a <code>SINGLE</code> signature is greater
than or equal to the number of outputs. In this BIP a
<code>0x0000......0000</code> is committed, without changing the semantics.</p>
</div>
<div class="footnote-definition" id="9"><sup class="footnote-definition-label">9</sup>
<p><a href="/144">BIP144: Segregated Witness (Peer
Services)</a></p>
</div>

    </div>

        </div>
    </section>
    <footer class="footer">
        <div class="container has-text-centered has-text-weight-bold is-family-monospace">
            <p class="mb-1">Updated <span class="tag is-medium is-warning is-light">2023-04-02</span></p>
            <p>bips.dev - Made with &#x2615; by <a href="https://twitter.com/nickmonad">nickmonad</a></p>
            <p>Check it out on <a href="https://github.com/nickmonad/bips-dev">GitHub</a></p>
            <p>Stay humble. Stack sats. &#x20bf;</p>
        </div>
    </footer>

     
</body>
</html>
